#!/bin/bash

# API Discovery Script

# Scans repository for Java and Node.js API endpoints

echo â€œğŸ” Starting API endpoint discoveryâ€¦â€

# Create output directories

mkdir -p generated/raw-endpoints
mkdir -p generated/openapi-specs
mkdir -p generated/bruno-collections

# Find Java endpoints

echo â€œğŸ” Scanning for Java endpointsâ€¦â€
find . -name â€œ*.javaâ€ -type f | while read -r file; do
echo â€œAnalyzing: $fileâ€

# Look for Spring Boot annotations

grep -n -E â€œ@(RestController|Controller|RequestMapping|GetMapping|PostMapping|PutMapping|DeleteMapping|PatchMapping)â€ â€œ$fileâ€ > /dev/null
if [ $? -eq 0 ]; then
echo â€œFound Spring Boot controller: $fileâ€

```
# Extract endpoint information
cat "$file" | grep -E -A 5 -B 2 "@(RequestMapping|GetMapping|PostMapping|PutMapping|DeleteMapping|PatchMapping)" >> "generated/raw-endpoints/java-endpoints.txt"
echo "---FILE: $file---" >> "generated/raw-endpoints/java-endpoints.txt"
```

fi

# Look for JAX-RS annotations

grep -n -E â€œ@(Path|GET|POST|PUT|DELETE|PATCH)â€ â€œ$fileâ€ > /dev/null
if [ $? -eq 0 ]; then
echo â€œFound JAX-RS resource: $fileâ€

```
# Extract endpoint information
cat "$file" | grep -E -A 5 -B 2 "@(Path|GET|POST|PUT|DELETE|PATCH)" >> "generated/raw-endpoints/jaxrs-endpoints.txt"
echo "---FILE: $file---" >> "generated/raw-endpoints/jaxrs-endpoints.txt"
```

fi
done

# Find Node.js endpoints

echo â€œğŸ” Scanning for Node.js endpointsâ€¦â€
find . -name â€œ*.jsâ€ -o -name â€œ*.tsâ€ | grep -E â€œ(route|router|app|server|controller)â€ | while read -r file; do
echo â€œAnalyzing: $fileâ€

# Look for Express.js routes

grep -n -E â€œ(app.|router.|express().*.(get|post|put|delete|patch)â€ â€œ$fileâ€ > /dev/null
if [ $? -eq 0 ]; then
echo â€œFound Express routes: $fileâ€

```
# Extract route information
cat "$file" | grep -E -A 3 -B 1 "(app\.|router\.|express\().*\.(get|post|put|delete|patch)" >> "generated/raw-endpoints/nodejs-endpoints.txt"
echo "---FILE: $file---" >> "generated/raw-endpoints/nodejs-endpoints.txt"
```

fi

# Look for Fastify routes

grep -n -E â€œfastify.(get|post|put|delete|patch)â€ â€œ$fileâ€ > /dev/null
if [ $? -eq 0 ]; then
echo â€œFound Fastify routes: $fileâ€

```
# Extract route information
cat "$file" | grep -E -A 3 -B 1 "fastify\.(get|post|put|delete|patch)" >> "generated/raw-endpoints/fastify-endpoints.txt"
echo "---FILE: $file---" >> "generated/raw-endpoints/fastify-endpoints.txt"
```

fi
done

# Create summary

echo â€œğŸ“Š Creating discovery summaryâ€¦â€
{
echo â€œ# API Endpoint Discovery Summaryâ€
echo â€œGenerated on: $(date)â€
echo â€œâ€
echo â€œ## Java Endpoints Found:â€
if [ -f â€œgenerated/raw-endpoints/java-endpoints.txtâ€ ]; then
echo â€œ- Spring Boot controllers: $(grep -c â€˜@Controller|@RestControllerâ€™ generated/raw-endpoints/java-endpoints.txt || echo 0)â€
echo â€œ- Request mappings: $(grep -c â€˜@.*Mappingâ€™ generated/raw-endpoints/java-endpoints.txt || echo 0)â€
fi

if [ -f â€œgenerated/raw-endpoints/jaxrs-endpoints.txtâ€ ]; then
echo â€œ- JAX-RS resources: $(grep -c â€˜@Pathâ€™ generated/raw-endpoints/jaxrs-endpoints.txt || echo 0)â€
echo â€œ- JAX-RS methods: $(grep -c â€˜@GET|@POST|@PUT|@DELETE|@PATCHâ€™ generated/raw-endpoints/jaxrs-endpoints.txt || echo 0)â€
fi

echo â€œâ€
echo â€œ## Node.js Endpoints Found:â€
if [ -f â€œgenerated/raw-endpoints/nodejs-endpoints.txtâ€ ]; then
echo â€œ- Express routes: $(grep -c â€˜app.|router.â€™ generated/raw-endpoints/nodejs-endpoints.txt || echo 0)â€
fi

if [ -f â€œgenerated/raw-endpoints/fastify-endpoints.txtâ€ ]; then
echo â€œ- Fastify routes: $(grep -c â€˜fastify.â€™ generated/raw-endpoints/fastify-endpoints.txt || echo 0)â€
fi
} > generated/discovery-summary.md

echo â€œâœ… API discovery complete! Check generated/discovery-summary.md for results.â€
